const Discord = require("discord.js");
const client = new Discord.Client();

client.on('guildMemberAdd', member => {
const mohamed= member.guild.channels.get("520153404438347779");
if(!mohamed) return;
if(mohamed) {
setTimeout(() => mohamed.send(`** Welcome To Epic Shop**    
              **-**  **We Hope You Like It**  :gift_heart:`), 4000)        
}
});

client.on('guildMemberAdd', member => {
const mohamed= member.guild.channels.get("520270925560807450");
if(!mohamed) return;
if(mohamed) {
setTimeout(() => mohamed.send(`#role humans epic`), 4000)        
}
});

const invites = {};

const wait = require('util').promisify(setTimeout);

client.on('ready', () => {
  wait(1000);

  client.guilds.forEach(g => {
    g.fetchInvites().then(guildInvites => {
      invites[g.id] = guildInvites;
    });
  });
});

client.on('guildMemberAdd', member => {
  member.guild.fetchInvites().then(guildInvites => {
    const ei = invites[member.guild.id];
    invites[member.guild.id] = guildInvites;
    const invite = guildInvites.find(i => ei.get(i.code).uses < i.uses);
    const inviter = client.users.get(invite.inviter.id);
    const logChannel = member.guild.channels.find(channel => channel.name === "invite");
    logChannel.send(`${member} Invited by: <@${inviter.id}>`);
  });
});

client.on('message', message => {
var prefix = "$" // Ø§Ù„Ø¨Ø±ÙŠÙÙƒØ³
if(message.content.startsWith(prefix +"server")){ // Ø§Ù„Ø§Ù…Ø±
  if(!message.guild.member(message.author).hasPermission("ADMINISTRATOR")) return message.reply(`**Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§ØµÙŠØ© Ù„Ù„Ø§Ø¯Ø§Ø±Ø© ÙÙ‚Ø·** :negative_squared_cross_mark: `)
if(!message.channel.guild) return message.reply(' ');
const millis = new Date().getTime() - message.guild.createdAt.getTime();
const now = new Date();
const verificationLevels = ['None', 'Low', 'Medium', 'Insane', 'Extreme'];
const days = millis / 1000 / 60 / 60 / 24;
var embed  = new Discord.RichEmbed()
.setAuthor(message.guild.name, message.guild.iconURL)
.addField("**ðŸ†” Server ID:**", message.guild.id,true)
.addField("**ðŸ“… Created On**", message.guild.createdAt.toLocaleString(),true)
.addField("**ðŸ‘‘ Owned by**",`${message.guild.owner.user.username}#${message.guild.owner.user.discriminator}`)
.addField("**ðŸ‘¥ Members**",`[${message.guild.memberCount}]`,true)
.addField('**ðŸ’¬ Channels **',`**${message.guild.channels.filter(m => m.type === 'text').size}**` + ' text | Voice  '+ `**${message.guild.channels.filter(m => m.type === 'voice').size}** `,true)
.addField("**ðŸŒ Others **" , message.guild.region,true)
.setColor('#000000')
message.channel.sendEmbed(embed)
 
}
});

client.on('message' , async (message) => {
var prefix = "$" // Ø§Ù„Ø¨Ø±ÙŠÙÙƒØ³
 if (message.content.startsWith(prefix + 'w')) {
  const args = message.content.substring(prefix.length).split(' ');

 message.delete();
args.shift() 
let msg = args.join(' ') 
message.channel.createWebhook(message.author.username, message.author.avatarURL) 
    .then(wb => {
        const user = new Discord.WebhookClient(wb.id, wb.token) 
        user.send(msg); 
        user.delete() 
    })
    .catch(console.error)
 }
});

client.on('message', message => {
    let prefix = '$'
    
    if(message.author.bot) return;
    if(message.content == prefix + 'help'){
        let Hembed = new Discord.RichEmbed()
     .setAuthor('BOT')    
     .setColor("GRAY")
     .setDescription(`
     **Server Help List**
broadcast =$all
clear chat =$clear
server info =$server
close room =$close
open room =$open
close ticket =$closetk - $close
hide room =$hide
show room =$show
say =$say
`
);
    message.author.sendEmbed(Hembed);
    message.channel.send('**ØªÙ… Ø§Ù„Ø§Ø±Ø³Ø§Ù„ ÙÙŠ Ø§Ù„Ø®Ø§Øµ**');

}
});

client.on("guildMemberAdd", member => {
  member.createDM().then(function (channel) {
  return channel.send(`:rose:  ÙˆÙ„ÙƒÙ… Ù†ÙˆØ±Øª Ø§Ù„Ø³ÙŠØ±ÙØ±:rose: 
:crown:Ø§Ø³Ù… Ø§Ù„Ø¹Ø¶Ùˆ  ${member}:crown:  
Ø§Ù†Øª Ø§Ù„Ø¹Ø¶Ùˆ Ø±Ù‚Ù… ${member.guild.memberCount} `) 
}).catch(console.error)
})

var prefix = "$"
client.on('message', message => {
  if (message.author.xErenaa) return;
  if (!message.content.startsWith(prefix)) return;
 
  let command = message.content.split(" ")[0];
  command = command.slice(prefix.length);
 
  let args = message.content.split(" ").slice(1);
 
  if (command == "ban") {
               if(!message.channel.guild) return message.reply('** This command only for servers**');
         
  if(!message.guild.member(message.author).hasPermission("BAN_MEMBERS")) return message.reply("**You Don't Have ` BAN_MEMBERS ` Permission**");
  if(!message.guild.member(client.user).hasPermission("BAN_MEMBERS")) return message.reply("**I Don't Have ` BAN_MEMBERS ` Permission**");
  let user = message.mentions.users.first();
  let reason = message.content.split(" ").slice(2).join(" ");
  /*let bErenaalog = client.channels.find("name", "Erenaa-log");
 
  if(!bErenaalog) return message.reply("I've detected that this server doesn't have a Erenaa-log text channel.");*/
  if (message.mentions.users.size < 1) return message.reply("**Ù…Ù†Ø´Ù† Ø´Ø®Øµ**");
  if(!reason) return message.reply ("**Ø§ÙƒØªØ¨ Ø³Ø¨Ø¨ Ø§Ù„Ø·Ø±Ø¯**");
  if (!message.guild.member(user)
  .bannable) return message.reply("**Ù„Ø§ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø·Ø±Ø¯ Ø´Ø®Øµ Ø§Ø¹Ù„Ù‰ Ù…Ù† Ø±ØªØ¨ØªÙŠ ÙŠØ±Ø¬Ù‡ Ø§Ø¹Ø·Ø§Ø¡ Ø§Ù„Ø¨ÙˆØª Ø±ØªØ¨Ù‡ Ø¹Ø§Ù„ÙŠ**");
 
  message.guild.member(user).ban(7, user);
 
  const banembed = new Discord.RichEmbed()
  .setAuthor(`BANNED!`, user.displayAvatarURL)
  .setColor("RANDOM")
  .setTimestamp()
  .addField("**User:**",  '**[ ' + `${user.tag}` + ' ]**')
  .addField("**By:**", '**[ ' + `${message.author.tag}` + ' ]**')
  .addField("**Reason:**", '**[ ' + `${reason}` + ' ]**')
  message.channel.send({
    embed : banembed
  })
}
});

client.login(process.env.BOT_TOKEN);// Ù„Ø§ ØªØºÙŠØ± ÙÙŠÙ‡Ø§ Ø´ÙŠØ¡
